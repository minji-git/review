<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">
	
	<select id="all" resultType="com.project2.vo.ReviewVO">
		SELECT M.*, R.*
		FROM REVIEW R, MOVIE M
		WHERE R.M_NO = M.M_NO
		ORDER BY R.R_NO DESC
	</select>
	
	<select id="one" parameterType="map" resultType="reviewVO">
		SELECT M.*, R.* 
		FROM REVIEW R, MOVIE M
		WHERE R.M_NO = M.M_NO
		<choose>
			<when test="idx == 0">
				AND M.M_TITLE = #{keyword}
			</when>
			<when test="idx == 1">
				AND R.R_NICK = #{keyword}
			</when>
			<when test="idx == 2">
				AND TO_CHAR(R.R_DATE, 'YYYYMMDD') = #{keyword}
			</when>
			<otherwise>
				AND 1 = 2
			</otherwise>
		</choose>
		ORDER BY R.R_NO DESC
	</select>
	
</mapper>